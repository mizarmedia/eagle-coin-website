---
interface Props {
  title?: string;
  subtitle?: string;
}

const {
  title = "Eagle Coin & Precious Metals",
  subtitle = "Buying and Selling Rare Coins and Bullion Products"
} = Astro.props;
---

<section class="relative min-h-[70vh] md:min-h-screen flex flex-col overflow-hidden">
  <!-- Background Image with Overlay -->
  <div class="absolute inset-0">
    <img
      src="/images/hero-bg.webp"
      alt="Collection of rare gold and silver coins displayed at Eagle Coin & Precious Metals in Eagle, Idaho"
      width="1200"
      height="800"
      class="w-full h-full object-cover"
      loading="eager"
      fetchpriority="high"
    />
    <div class="absolute inset-0 bg-gradient-to-b from-navy/80 via-navy/70 to-navy/90"></div>
  </div>

  <!-- Spacer for fixed header -->
  <div class="h-16 md:h-20 flex-shrink-0"></div>

  <!-- Main Content - grows to fill space and centers content -->
  <div class="relative z-10 flex-1 flex items-center justify-center px-4 sm:px-6 lg:px-8 py-6 md:py-12">
    <div class="max-w-5xl mx-auto text-center">
      <!-- Roundtable Badge -->
      <div class="hero-reveal inline-flex items-center gap-2 bg-gold/20 border border-gold/40 rounded-full px-3 py-1.5 md:px-4 md:py-2 mb-4 md:mb-8 backdrop-blur-sm" style="--delay: 0ms">
        <svg class="w-4 h-4 md:w-5 md:h-5 text-gold" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg>
        <span class="text-gold-light text-xs md:text-sm font-medium">SW Idaho's ONLY Roundtable Authorized Dealer</span>
      </div>

      <!-- Main Title -->
      <h1 class="font-display text-2xl sm:text-4xl md:text-5xl lg:text-7xl font-bold text-text-light mb-3 md:mb-6 leading-tight">
        <span class="hero-reveal block" style="--delay: 150ms">Eagle Coin</span>
        <span class="hero-reveal block text-gold" style="--delay: 300ms">&amp; Precious Metals</span>
      </h1>

      <!-- Subtitle -->
      <p class="hero-reveal text-lg sm:text-xl md:text-2xl text-text-light/80 mb-4 md:mb-8 max-w-2xl mx-auto font-light" style="--delay: 450ms">
        {subtitle}
      </p>

      <!-- Location -->
      <p class="hero-reveal text-gold/90 text-base md:text-lg mb-6 md:mb-10" style="--delay: 550ms">
        Located in Downtown Eagle, Idaho
      </p>

      <!-- CTA Buttons -->
      <div class="hero-reveal flex flex-col sm:flex-row gap-3 md:gap-4 justify-center" style="--delay: 650ms">
        <a
          href="/sell"
          class="btn-primary-glow inline-flex items-center justify-center px-6 py-3 md:px-8 md:py-4 bg-gradient-to-r from-gold to-gold-accent text-navy font-semibold rounded-lg shadow-lg shadow-gold/25 hover:shadow-gold/40 hover:scale-105 transition-all duration-300 min-h-[44px]"
        >
          Sell Your Coins
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
        <a
          href="/buy"
          class="inline-flex items-center justify-center px-6 py-3 md:px-8 md:py-4 border-2 border-gold text-gold font-semibold rounded-lg hover:bg-gold/10 hover:scale-105 transition-all duration-300 min-h-[44px]"
        >
          Browse Inventory
        </a>
      </div>

      <!-- Trust Indicators - Google rating only on mobile, all on desktop -->
      <div class="hero-reveal mt-6 md:mt-12 flex flex-wrap justify-center gap-4 md:gap-8 text-text-light/70 text-sm" style="--delay: 800ms">
        <div class="flex items-center gap-2">
          <div class="flex text-gold">
            {[...Array(5)].map(() => (
              <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            ))}
          </div>
          <span>4.9-Star Google Rating</span>
        </div>
        <div class="hidden md:flex items-center gap-2">
          <svg class="w-5 h-5 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
          <span>Authenticity Guaranteed</span>
        </div>
        <div class="hidden md:flex items-center gap-2">
          <svg class="w-5 h-5 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          <span>House Calls Available</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Spot Prices - Full Width Bar at Bottom (in normal flow) -->
  <div class="hero-reveal relative z-10 flex-shrink-0 bg-navy-light/80 backdrop-blur-sm border-t border-gold/20" style="--delay: 1000ms">
    <div class="flex items-center justify-center gap-2 sm:gap-4 md:gap-8 flex-wrap text-xs sm:text-sm py-3 sm:py-4 px-3 sm:px-4">
      <span class="text-text-light/50 text-xs uppercase tracking-wide">Live Spot</span>
      <div class="flex items-center gap-1 sm:gap-2">
        <span class="text-gold font-medium">Gold:</span>
        <span id="hero-gold-price" class="text-text-light font-semibold">Loading...</span>
      </div>
      <div class="hidden sm:block w-px h-4 bg-gold/30"></div>
      <div class="flex items-center gap-1 sm:gap-2">
        <span class="text-gold font-medium">Silver:</span>
        <span id="hero-silver-price" class="text-text-light font-semibold">Loading...</span>
      </div>
      <div class="hidden sm:block w-px h-4 bg-gold/30"></div>
      <div class="hidden sm:flex items-center gap-2">
        <span class="text-gold font-medium">Platinum:</span>
        <span id="hero-platinum-price" class="text-text-light font-semibold">Loading...</span>
      </div>
    </div>
  </div>
</section>

<script>
  // Store previous prices for hero comparison
  const heroPreviousPrices: Record<string, number> = {};

  function animateHeroPriceChange(el: HTMLElement, newPrice: number, metalKey: string) {
    const oldPrice = heroPreviousPrices[metalKey];
    heroPreviousPrices[metalKey] = newPrice;

    el.textContent = `$${newPrice.toFixed(2)}`;

    // Remove any existing animation classes
    el.classList.remove('price-update', 'price-up', 'price-down');

    // Only animate if we have a previous price to compare
    if (oldPrice !== undefined && oldPrice !== newPrice) {
      if (newPrice > oldPrice) {
        el.classList.add('price-up');
      } else {
        el.classList.add('price-down');
      }
    } else if (oldPrice === undefined) {
      // First load - just pulse
      el.classList.add('price-update');
    }

    // Remove animation class after animation completes
    setTimeout(() => {
      el.classList.remove('price-update', 'price-up', 'price-down');
    }, 300);
  }

  async function fetchHeroSpotPrices() {
    const goldEl = document.getElementById('hero-gold-price');
    const silverEl = document.getElementById('hero-silver-price');
    const platinumEl = document.getElementById('hero-platinum-price');

    try {
      const response = await fetch('https://api.metals.dev/v1/latest?api_key=demo&currency=USD&unit=toz');

      if (!response.ok) throw new Error('API request failed');

      const data = await response.json();

      if (data && data.metals) {
        if (goldEl && data.metals.gold) animateHeroPriceChange(goldEl, data.metals.gold, 'hero-gold');
        if (silverEl && data.metals.silver) animateHeroPriceChange(silverEl, data.metals.silver, 'hero-silver');
        if (platinumEl && data.metals.platinum) animateHeroPriceChange(platinumEl, data.metals.platinum, 'hero-platinum');
      } else {
        throw new Error('Invalid data');
      }
    } catch (error) {
      if (goldEl) goldEl.textContent = 'Call for quote';
      if (silverEl) silverEl.textContent = 'Call for quote';
      if (platinumEl) platinumEl.textContent = 'Call for quote';
    }
  }

  fetchHeroSpotPrices();
  setInterval(fetchHeroSpotPrices, 5 * 60 * 1000);
</script>
